/*
 * This file was generated by the Gradle 'init' task.
 */

import nu.studer.gradle.jooq.JooqEdition

plugins {
    id 'flyway.jooq.test.kotlin-library-conventions'
    id "nu.studer.jooq" version "5.2"
}

dependencies {
    implementation project(":db-migration")
    implementation "org.jooq:jooq:${jooqVersion}"
    implementation "org.jooq:jooq-meta:${jooqVersion}"
    implementation "org.jooq:jooq-codegen:${jooqVersion}"

    jooqGenerator "org.postgresql:postgresql:${postgresqlDriverVersion}"
    jooqGenerator project(':db-jooq-gen')
}

// https://github.com/etiennestuder/gradle-jooq-plugin
jooq {
    version = "${jooqVersion}"
    edition = JooqEdition.OSS

    configurations {
        main {
            generationTool {
                logging = org.jooq.meta.jaxb.Logging.WARN
                jdbc {
                    driver = 'org.postgresql.Driver'
                    url = 'jdbc:postgresql://localhost:5432/postgres'
                    user = 'postgres'
                    password = 'password'
                }
                generator {
                    name = 'flyway.jooq.db.gen.CustomGenerator'
                    database {
                        name = 'org.jooq.meta.postgres.PostgresDatabase'
                        inputSchema = 'public'
                        excludes = 'flyway_schema_history'
                    }
                    strategy {
                        name = 'flyway.jooq.db.gen.CustomNamingGeneratorStrategy'
                    }
                    generate {
                        deprecated = true
                        records = true
                        immutablePojos = true
                        fluentSetters = true
                        daos = true
//                        nonnullAnnotation = true
//                        nonnullAnnotationType = 'javax.annotation.Nonnull'
                    }
                    target {
                        packageName = 'flyway.jooq.db.gen'
//                        directory = 'src/main/generated'
                    }
                }
            }
        }
    }
}
generateJooq.dependsOn(":db-migration:flywayMigrate")
